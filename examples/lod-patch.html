<head> </head>
<body>
  <div id="container"></div>
  <script type="module" async>
    import { quadPatchPrototype, quadPatch } from "../src/lod-patches.ts";
    import {
      asSvg,
      circle,
      svgDoc,
      group,
      polygon,
      vertices,
      center,
      rect,
      text,
    } from "@thi.ng/geom";
    import { dist } from "@thi.ng/vectors";
    import { zip } from "lodash-es";
    import { DVMesh } from "@thi.ng/geom-voronoi";

    const drawQuad = ({ points, index, weights }) => {
      points = points.map((p) => p.map(rescale));
      const labelPoints = [
        [0.1, 0.5],
        [0.5, 0.1],
        [0.9, 0.5],
        [0.5, 0.9],
      ].map((p) => p.map(rescale));

      const bounds = vertices(rect(scale));
      const mesh = new DVMesh(points);
      const circles = points.map((p) => circle(p, 2));

      const labels = zip(labelPoints, weights).map(([pt, lod]) =>
        text(pt, lod)
      );

      return svgDoc(
        {
          fill: "deeppink",
          stroke: "none",
          "stroke-width": "0.25",
          //
          // width: "100%",
        },
        group(
          {
            fill: "none",
            stroke: "white",
          },
          mesh.delaunay(bounds).map((p) => polygon(p))
        ),

        group(
          {
            "text-anchor": "middle",
            font: "sans",
            "alignment-baseline": "middle",
            "font-size": "16pt",
          },
          [
            group(
              {
                stroke: "black",
                "stroke-opacity": 0.7,
                "stroke-width": 20,
              },
              labels
            ),
            group(
              {
                stroke: "none",
              },
              labels
            ),
          ]
        )
      );
    };
    const patches = [
      [32, 64, 64, 4],
      [64, 16, 16, 32],
      [8, 4, 16, 8],
      [16, 32, 64, 256],
    ].map((weights) => ({ ...quadPatch(...weights), weights }));

    const scale = 400;
    const rescale = (x) => scale * x;

    const patchesSvg = patches.map(drawQuad);
    console.log(patchesSvg);
    const svg = document.createElement("svg");
    document.querySelector("div#container").appendChild(svg);
    svg.outerHTML = asSvg(...patchesSvg);
  </script>
  <style>
    body {
      margin: 20em;
      background-color: black;
    }
    #container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-gap: 0;
      width: 100%;
    }
    svg {
      aspect-ratio: 1/1;
      padding: 0;
      margin: 0;
      width: 100%;
      height: 100%;
    }
  </style>
</body>
